<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/bots/infodump/infodump.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/dramamine/leftovers-again.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ai.js~AI.html">AI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/battle.js~Battle.html">Battle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/connection.js~Connection.html">Connection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/decisions.js~Decision.html">Decision</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/decisions.js~MOVE.html">MOVE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/decisions.js~SWITCH.html">SWITCH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/listener.js~Listener.html">Listener</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/log.js~Log.html">Log</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/monkey.js~Monkey.html">Monkey</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/report.js~Report.html">Report</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/team.js~Team.html">Team</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-botFinder">botFinder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-start">start</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">game</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/game/typechart.js~Typechart.html">Typechart</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">interfaces</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/interfaces/cli.js~Interactive.html">Interactive</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/interfaces/params.js~Challenger.html">Challenger</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">model</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/model/battlestore.js~BattleStore.html">BattleStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/model/challenges.js~Challenger.html">Challenger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/model/lobby.js~Lobby.html">Lobby</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/model/pokemon.js~Pokemon.html">Pokemon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/model/side.js~Side.html">Side</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/model/timer.js~Timer.html">Timer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MoveData">MoveData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-PokemonData">PokemonData</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/bots/infodump/infodump.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Get some helpful info about pokemon &amp; their moves
 *
 */

const AI = require(&apos;@la/ai&apos;);
const Damage = require(&apos;@la/game/damage&apos;);
const KO = require(&apos;@la/game/kochance&apos;);
const Typechart = require(&apos;@la/game/typechart&apos;);
const Formats = require(&apos;@la/data/formats&apos;);
const Log = require(&apos;@la/log&apos;);
const util = require(&apos;@la/pokeutil&apos;);

const { MOVE, SWITCH } = require(&apos;@la/decisions&apos;);

class Infodump extends AI {
  decide(state) {
    Log.info(&apos;infodumps state:: &apos;, state);
    Damage.assumeStats(state.opponent.active);
    if (state.forceSwitch) {
      // our pokemon died :(
      // choose a random one
      //
      const possibleMons = state.self.reserve.filter((mon) =&gt; {
        if (mon.condition === &apos;0 fnt&apos;) return false;
        if (mon.active) return false;
        return true;
      });
      const myMon = this.pickOne(possibleMons);
      return new SWITCH(myMon);
    }


    // check each move
    let maxDamage = 0;
    let bestMove = 0;

    state.self.active.moves.forEach((move, idx) =&gt; {
      if (move.disabled) return;
      if (move.pp === 0) return;
      let est = -1;
      try {
        est = Damage.getDamageResult(
          state.self.active,
          state.opponent.active,
          move,
          { weather: state.weather }
        );
      } catch (e) {
        Log.error(e);
        Log.error(state.self.active, state.opponent.active, move);
      }
      Log.info(&apos;estimated &apos; + est + &apos; for move &apos; + move.name);
      if (est &gt; maxDamage) {
        maxDamage = est;
        bestMove = idx;
      }
    });

    return new MOVE(bestMove);
  }

  getHelp(state) {
    // console.log(&apos;infodumps help state:: &apos;, state);
    Damage.assumeStats(state.opponent.active);

    const extra = {};

    try {
      extra.moves = this.moves(state);
    } catch (e) {
      Log.error(e);
      Log.error(JSON.stringify(state));
    }
    try {
      extra.switches = this.switches(state);
    } catch (e) {
      Log.error(e);
      Log.error(JSON.stringify(state));
    }

    return extra;
  }

  moves(state) {
    const extra = [];
    // this&apos;ll be null during forceSwitch
    if (state.self.active &amp;&amp; state.self.active.moves) {
      state.self.active.moves.forEach( (move) =&gt; {
        let est = [-1];
        if (!move.disabled) {
          try {
            est = Damage.getDamageResult(
              state.self.active,
              state.opponent.active,
              move,
              { weather: state.weather }
            );
          } catch (e) {
            Log.error(e);
          }
        }
        const ko = KO.predictKO(est, state.opponent.active);
        extra.push({
          name: move.name,
          dmgMin: est[0],
          dmgMax: est[est.length - 1],
          koTurn: ko.turns || null,
          koChance: ko.chance || null
        });
      });
    }
    return extra;
  }

  switches(state) {
    Log.log(&apos;input:&apos;);
    Log.log(JSON.stringify(state));
    // query for moves
    const formatData = Formats[util.toId(state.opponent.active.species)];
    const possibleMoves = formatData.randomBattleMoves;
    if (!possibleMoves) {
      return {
        error: &apos;couldnt find species in random moves dictionary: &apos; +
          state.opponent.active.species
      };
    }
    // for each of my pokemons...
    const results = state.self.reserve.map((mon) =&gt; {
      // see how the opponent would fare against this mon of mine.
      const yourMoves = possibleMoves.map(move =&gt; {
        // check damage from each of the opponent&apos;s moves against this mon.
        let est = [-1];
        try {
          est = Damage.getDamageResult(
            state.opponent.active,
            mon,
            move,
            { weather: state.weather }
          );
        } catch (e) {
          Log.error(e, state.opponent.active, mon, move);
        }
        return {
          name: move, // this is just the ID of a move
          dmg: est,
          against: mon
        };
      }).sort((a, b) =&gt; a.dmg[0] &lt; b.dmg[0]);

      // see how my moves would fare against the opponent&apos;s current mon.
      const myMoves = mon.moves.map(move =&gt; {
        let est = [-1];
        try {
          est = Damage.getDamageResult(
            mon, // my mon
            state.opponent.active,
            move, // my move
            { weather: state.weather }
          );
          Log.info(&apos;my &apos; + mon.species + &apos; uses &apos; + move.name + &apos; against &apos;
            + state.opponent.active.species + &apos;:&apos;, est);
        } catch (e) {
          Log.error(e);
        }

        return {
          name: move.id, // this is a move object
          dmg: est,
          against: state.opponent.active
        };
      }).sort((a, b) =&gt; a.dmg[0] &lt; b.dmg[0]);

      // also check type advantage of mons in general
      let strength = false;
      let weakness = false;
      const attacks = [];
      const defenses = [];
      state.opponent.active.types.forEach((yourtype) =&gt; {
        mon.types.forEach((mytype) =&gt; {
          attacks.push(Typechart.compare(mytype, yourtype));
          defenses.push(Typechart.compare(yourtype, mytype));
        });
      });

      const maxatk = Math.max(...attacks);
      const maxdef = Math.max(...defenses);
      if (maxatk &gt; 1) strength = true;
      if (maxdef &gt; 1) weakness = true;

      // console.log(mon);

      const yourBest = yourMoves[0];
      Log.info(&apos;predicting KO..&apos;, yourBest.dmg, yourBest.against);
      const yourKO = KO.predictKO(yourBest.dmg, yourBest.against);


      const myBest = myMoves[0];
      Log.info(&apos;predicting KO..&apos;, myBest.dmg, myBest.against);
      const myKO = KO.predictKO(myBest.dmg, myBest.against);


      return {
        species: mon.species,
        active: mon.active,
        yourBest: {
          name: yourBest.name,
          dmgMin: yourBest.dmg[0],
          dmgMax: yourBest.dmg[yourBest.dmg.length - 1],
          koTurns: yourKO.turns,
          koChance: yourKO.chance
        },
        myBest: {
          name: myBest.name,
          dmgMin: myBest.dmg[0],
          dmgMax: myBest.dmg[myBest.dmg.length - 1],
          koTurns: myKO.turns,
          koChance: myKO.chance
        },
        strength,
        weakness
      };
    });
    Log.log(&apos;output:&apos;);
    Log.log(results);
    return results;
  }

  pickOne(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }
}

module.exports = Infodump;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
